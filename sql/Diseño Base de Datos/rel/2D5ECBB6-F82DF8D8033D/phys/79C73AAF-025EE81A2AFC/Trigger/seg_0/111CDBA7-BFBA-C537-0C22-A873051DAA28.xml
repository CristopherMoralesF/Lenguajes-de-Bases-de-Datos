<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="TRG_CREATE_ASSET" directorySegmentName="seg_0" id="111CDBA7-BFBA-C537-0C22-A873051DAA28">
<sourceConnName>Curso+Base+de+datos.</sourceConnName>
<sourceObjSchema>CRIS</sourceObjSchema>
<sourceObjName>TRG_CREATE_ASSET</sourceObjName>
<createdBy>Admin</createdBy>
<createdTime>2022-12-16 06:26:48 UTC</createdTime>
<ownerDesignName>Diseño Base de Datos</ownerDesignName>
<actions>INSERT</actions>
<body><![CDATA[DECLARE
    VAR_ACCOUNT_DEBIT   CUENTA_CONTABLE.ID_CUENTA%TYPE;
    VAR_ACCOUNT_CREDIT  CUENTA_CONTABLE.ID_CUENTA%TYPE;
    VAR_JE_DESCRIPTION  VARCHAR(255);
    VAR_NEW_JE_ID       ASIENTO_LINEA.ID_ASIENTO%TYPE;
BEGIN

    -- Select Account
    SELECT ID_CUENTA INTO VAR_ACCOUNT_DEBIT FROM CLASE_CUENTA WHERE ID_CLASE = :NEW.ID_CLASE AND ID_CATEGORIA_CUENTA = 1;
    VAR_ACCOUNT_CREDIT := '1-1-1-101392';
    VAR_JE_DESCRIPTION := 'Asset Recognition: ' || :NEW.ID_CLASE || ' - ' || :NEW.DESCRIPCION_ACTIVO;


    -- Create journal header
    INSERT INTO ASIENTO (ID_CLASE,FECHA,DESCRIPCIÓN) VALUES (:NEW.ID_CLASE,SYSDATE,VAR_JE_DESCRIPTION) RETURNING ID_ASIENTO INTO VAR_NEW_JE_ID;

    -- Create Journal body
    INSERT INTO ASIENTO_LINEA (ID_ASIENTO, ID_CUENTA_CONTABLE,DESCRIPCION_LINEA,DEBITO,CREDITO) VALUES (VAR_NEW_JE_ID,VAR_ACCOUNT_DEBIT,VAR_JE_DESCRIPTION,:NEW.VALOR_ADQUISICION,0);
    INSERT INTO ASIENTO_LINEA (ID_ASIENTO, ID_CUENTA_CONTABLE,DESCRIPCION_LINEA,DEBITO,CREDITO) VALUES (VAR_NEW_JE_ID,VAR_ACCOUNT_CREDIT,VAR_JE_DESCRIPTION,0,:NEW.VALOR_ADQUISICION);

    -- Update Account Balance
    -- Debit Account
    UPDATE CUENTA_CONTABLE SET TOTAL_DEBITOS = TOTAL_DEBITOS + :NEW.VALOR_ADQUISICION WHERE ID_CUENTA = VAR_ACCOUNT_DEBIT;
    UPDATE CUENTA_CONTABLE SET BALANCE = TOTAL_DEBITOS - TOTAL_CREDITOS  WHERE ID_CUENTA = VAR_ACCOUNT_DEBIT;   

     -- Credit Account
    UPDATE CUENTA_CONTABLE SET TOTAL_CREDITOS = TOTAL_CREDITOS + :NEW.VALOR_ADQUISICION WHERE ID_CUENTA = VAR_ACCOUNT_CREDIT;
    UPDATE CUENTA_CONTABLE SET BALANCE = TOTAL_DEBITOS - TOTAL_CREDITOS  WHERE ID_CUENTA = VAR_ACCOUNT_CREDIT;   


END;]]></body>
<triggerTime>AFTER</triggerTime>
<owner>9039F05B-50C8-092B-7F6E-D2C55D2BE6E1</owner>
<table>BF2CF1F7-1073-3567-7FA9-1BEB4C2C8D7D</table>
</TriggerOraclev10g>